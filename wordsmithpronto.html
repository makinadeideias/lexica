<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jumble - Sentence Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Delius&family=Short+Stack&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #58CC02 0%, #58CC02 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
            font-family: 'Delius', cursive;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            width: 100%;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 8px;
            color: white;
            font-weight: 800;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            font-family: 'Short Stack', cursive;
        }
        
        .tagline {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
            font-family: 'Short Stack', cursive;
        }
        
        .user-section {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        input {
            padding: 14px 18px;
            border: 3px solid #FFC800;
            border-radius: 14px;
            font-size: 0.95rem;
            width: 240px;
            background: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 0 #E6BE00;
            font-family: 'Delius', cursive;
            color: #333;
        }
        
        input:focus {
            outline: none;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #E6BE00;
        }
        
        .game-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .word-cloud {
            width: 100%;
            min-height: 160px;
            background: white;
            border-radius: 18px;
            padding: 22px;
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            justify-content: center;
            align-items: center;
            border: 4px solid #FFC800;
            box-shadow: 0 6px 0 #E6BE00;
        }
        
        .sentence-area {
            width: 100%;
            min-height: 160px;
            background: white;
            border-radius: 18px;
            padding: 22px;
            display: flex;
            flex-direction: column;
            border: 4px solid #FFC800;
            box-shadow: 0 6px 0 #E6BE00;
        }
        
        .sentence-display {
            flex-grow: 1;
            background: #F0F8FF;
            border-radius: 14px;
            padding: 20px;
            min-height: 120px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            border: 2px dashed #58CC02;
        }
        
        .word {
            background: #58CC02;
            color: white;
            padding: 14px 20px;
            border-radius: 14px;
            cursor: pointer;
            user-select: none;
            font-size: 1.05rem;
            font-weight: 600;
            box-shadow: 0 4px 0 #4AA300;
            transition: all 0.2s ease;
            border: none;
            min-width: 90px;
            text-align: center;
            font-family: 'Delius', cursive;
        }
        
        .word:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #4AA300;
        }
        
        .word:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #4AA300;
        }
        
        .word.in-sentence {
            background: #FF9600;
            box-shadow: 0 4px 0 #E08700;
        }
        
        .word.correct {
            background: #58CC02;
            box-shadow: 0 4px 0 #4AA300;
            animation: bounce 0.5s ease;
        }
        
        .word.wrong {
            background: #FF4B4B;
            box-shadow: 0 4px 0 #E04040;
            animation: shake 0.4s ease;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: nowrap;
            justify-content: center;
        }
        
        button {
            padding: 14px 24px;
            border: none;
            border-radius: 14px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Short Stack', cursive;
            color: white;
            flex: 1;
            max-width: 140px;
        }
        
        #start-btn {
            background: #FFC800;
            box-shadow: 0 4px 0 #E6BE00;
        }
        
        #check-btn {
            background: #1CB0F6;
            box-shadow: 0 4px 0 #1899D6;
        }
        
        #reset-btn {
            background: #FF9600;
            box-shadow: 0 4px 0 #E08700;
        }
        
        #next-btn {
            background: #43e97b;
            box-shadow: 0 4px 0 #38d46a;
        }
        
        #giveup-btn {
            background: #FF4B4B;
            box-shadow: 0 4px 0 #E04040;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.2);
        }
        
        button:disabled {
            background: #CCCCCC;
            box-shadow: 0 4px 0 #AAAAAA;
            cursor: not-allowed;
            transform: none;
        }
        
        .feedback {
            margin-top: 18px;
            padding: 18px;
            border-radius: 14px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 700;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 700px;
            background: white;
            border: 4px solid #FFC800;
            box-shadow: 0 4px 0 #E6BE00;
            color: #333;
            font-family: 'Short Stack', cursive;
        }
        
        .score-panel {
            display: flex;
            gap: 16px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .score, .level, .phase, .sentences-completed, .streak {
            font-size: 1rem;
            background: white;
            padding: 14px 20px;
            border-radius: 14px;
            border: 3px solid #FFC800;
            box-shadow: 0 4px 0 #E6BE00;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #333;
            font-weight: 600;
            font-family: 'Delius', cursive;
        }
        
        .ranking-section {
            margin-top: 30px;
            width: 100%;
            max-width: 700px;
            background: white;
            border-radius: 18px;
            padding: 24px;
            border: 4px solid #FFC800;
            box-shadow: 0 6px 0 #E6BE00;
        }
        
        .ranking-title {
            text-align: center;
            margin-bottom: 18px;
            font-size: 1.6rem;
            color: #58CC02;
            font-weight: 800;
            font-family: 'Short Stack', cursive;
        }
        
        .ranking-list {
            list-style-type: none;
        }
        
        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            background: #F8F8F8;
            margin-bottom: 10px;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 2px solid #E8E8E8;
        }
        
        .ranking-item:hover {
            transform: translateX(5px);
            background: #F0F8FF;
            border-color: #58CC02;
        }
        
        .ranking-position {
            font-weight: bold;
            margin-right: 10px;
            font-size: 1.1rem;
            color: #FF9600;
            min-width: 25px;
        }
        
        .ranking-name {
            flex-grow: 1;
            font-weight: 600;
            color: #333;
            font-family: 'Delius', cursive;
            font-size: 0.95rem;
        }
        
        .ranking-score {
            font-weight: bold;
            color: #58CC02;
            font-size: 1rem;
        }
        
        .ranking-phase {
            margin-left: 12px;
            color: #1CB0F6;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .stars-container {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-left: 10px;
        }
        
        .star {
            color: #FFC800;
            font-size: 1.1rem;
        }
        
        .medal {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            margin-left: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
        }
        
        .bronze {
            background: linear-gradient(135deg, #CD7F32, #A56A2B);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .silver {
            background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .gold {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .platinum {
            background: linear-gradient(135deg, #E5E4E2, #B8B8B8);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .medals-info {
            margin-top: 18px;
            padding: 14px;
            background: #F0F8FF;
            border-radius: 12px;
            border: 2px solid #58CC02;
        }
        
        .medals-title {
            font-weight: 700;
            color: #58CC02;
            margin-bottom: 8px;
            text-align: center;
            font-family: 'Short Stack', cursive;
            font-size: 1.1rem;
        }
        
        .medals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
        }
        
        .medal-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            border-radius: 8px;
            background: white;
            font-size: 0.85rem;
        }
        
        .medal-item .medal {
            width: 18px;
            height: 18px;
            margin: 0;
            font-size: 0.6rem;
        }

        .credits {
            margin-top: 30px;
            padding: 15px;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            font-family: 'Delius', cursive;
        }
        
        /* Confetti canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-6px); }
            75% { transform: translateX(6px); }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
            }
            
            .word-cloud, .sentence-area {
                width: 100%;
            }
            
            .score-panel {
                flex-direction: column;
                align-items: center;
            }
            
            h1 {
                font-size: 2.4rem;
            }
            
            .controls {
                flex-wrap: wrap;
            }
            
            button {
                max-width: 120px;
                font-size: 0.9rem;
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>
    
    <div class="container">
        <header>
            <h1>WORDSMITH</h1>
            <p class="tagline">Click words to build sentences!</p>
        </header>
        
        <div class="user-section">
            <input type="text" id="username" placeholder="Enter your name">
            <button id="start-btn">Start Game</button>
        </div>
        
        <div class="game-area">
            <div class="word-cloud" id="word-cloud">
                <!-- Words will be inserted here via JavaScript -->
            </div>
            
            <div class="sentence-area">
                <div class="sentence-display" id="sentence-display">
                    <!-- Clicked words will appear here -->
                </div>
                <div class="controls">
                    <button id="check-btn" disabled>Check</button>
                    <button id="reset-btn" disabled>Reset</button>
                    <button id="next-btn" disabled>Next</button>
                    <button id="giveup-btn" disabled>Give Up</button>
                </div>
            </div>
        </div>
        
        <div class="feedback" id="feedback">
            Enter your name and click "Start Game" to begin!
        </div>
        
        <div class="score-panel">
            <div class="score">
                <span>Score:</span> <span id="score">0</span>
            </div>
            <div class="level">
                <span>Level:</span> <span id="level">A1</span>
            </div>
            <div class="phase">
                <span>Phase:</span> <span id="phase">1/11</span>
            </div>
            <div class="sentences-completed">
                <span>Sentences:</span> <span id="sentences-completed">0/3</span>
            </div>
            <div class="streak">
                <span>Streak:</span> <span id="streak">0</span>
            </div>
        </div>
        
        <div class="ranking-section">
            <h2 class="ranking-title">Player Ranking</h2>
            <ul class="ranking-list" id="ranking-list">
                <!-- Ranking will be inserted here via JavaScript -->
            </ul>
            
            <div class="medals-info">
                <h3 class="medals-title">Star & Medal System</h3>
                <div class="medals-grid">
                    <div class="medal-item">
                        <div class="medal platinum">P</div>
                        <span>Platinum: 12+ stars</span>
                    </div>
                    <div class="medal-item">
                        <div class="medal gold">G</div>
                        <span>Gold: 9-11 stars</span>
                    </div>
                    <div class="medal-item">
                        <div class="medal silver">S</div>
                        <span>Silver: 6-8 stars</span>
                    </div>
                    <div class="medal-item">
                        <div class="medal bronze">B</div>
                        <span>Bronze: 3-5 stars</span>
                    </div>
                    <div class="medal-item">
                        <span>‚≠ê = 500 points</span>
                    </div>
                    <div class="medal-item">
                        <span>üèÖ = 3 stars</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="credits">
            Created by Makina de Ideias
        </div>
    </div>

    <script>
        // Sentences database organized by phase - ALL A1 LEVEL with odd words
        const sentencesByPhase = {
            1: [
                "I eat an apple every day",
                "She reads a book quietly",
                "We play soccer outside",
                "He drinks water slowly",
                "They watch TV together",
                "You sing well today",
                "It runs fast always",
                "I see birds flying",
                "She writes letters carefully",
                "We learn English quickly"
            ],
            2: [
                "I am eating an apple now",
                "She is reading a book currently",
                "We are playing soccer today",
                "He is drinking water now",
                "They are watching TV tonight",
                "You are singing well now",
                "It is running fast today",
                "I am seeing birds flying",
                "She is writing letters now",
                "We are learning English today"
            ],
            3: [
                "I like red apples always",
                "She reads interesting books daily",
                "We play in the park often",
                "He drinks cold water sometimes",
                "They watch funny movies weekly",
                "You sing beautiful songs well",
                "It runs very fast always",
                "I see small birds outside",
                "She writes long letters carefully",
                "We learn new words quickly"
            ],
            4: [
                "I am eating a big red apple",
                "She is reading an interesting book",
                "We are playing soccer in the park",
                "He is drinking cold fresh water",
                "They are watching a funny movie",
                "You are singing a beautiful song",
                "It is running very fast today",
                "I am seeing small yellow birds",
                "She is writing a long letter",
                "We are learning new English words"
            ],
            5: [
                "My brother plays basketball every day",
                "Her sister reads books in the library",
                "Our friends watch movies on weekends",
                "His father drinks coffee in the morning",
                "Their mother cooks delicious food daily",
                "Your cousin sings in a band often",
                "My dog runs in the big garden",
                "Her cat sleeps on the soft bed",
                "Our teacher explains the lesson well",
                "Their baby cries when hungry always"
            ],
            6: [
                "My brother is playing basketball now",
                "Her sister is reading in the library",
                "Our friends are watching a movie",
                "His father is drinking hot coffee",
                "Their mother is cooking dinner",
                "Your cousin is singing right now",
                "My dog is running in the garden",
                "Her cat is sleeping peacefully",
                "Our teacher is explaining grammar",
                "Their baby is crying loudly"
            ],
            7: [
                "I always eat breakfast at seven",
                "She usually reads before sleeping",
                "We often play after school",
                "He sometimes drinks tea instead",
                "They never watch horror movies",
                "You often sing in the shower",
                "It always runs to the door",
                "I sometimes see my friends",
                "She always writes in her diary",
                "We usually learn vocabulary"
            ],
            8: [
                "I am currently eating my lunch",
                "She is always reading something",
                "We are usually playing outside",
                "He is sometimes drinking juice",
                "They are never watching that show",
                "You are often singing happily",
                "It is always running around",
                "I am sometimes seeing them",
                "She is always writing stories",
                "We are usually learning quickly"
            ],
            9: [
                "The happy children play in the sunny park",
                "The tall man reads the newspaper daily",
                "My best friend watches comedy shows",
                "The young boy drinks orange juice",
                "The old woman watches birds carefully",
                "Your beautiful sister sings professionally",
                "The small dog runs excitedly",
                "The colorful birds fly high",
                "The smart student writes perfectly",
                "The enthusiastic class learns rapidly"
            ],
            10: [
                "The happy children are playing in the park",
                "The tall man is reading the newspaper",
                "My best friend is watching a show",
                "The young boy is drinking juice",
                "The old woman is watching birds",
                "Your beautiful sister is singing now",
                "The small dog is running around",
                "The colorful birds are flying high",
                "The smart student is writing notes",
                "The enthusiastic class is learning"
            ],
            11: [
                "Every morning I eat a healthy breakfast",
                "Usually she reads interesting story books",
                "Often we play football with our friends",
                "Sometimes he drinks warm milk at night",
                "Never they watch television after ten",
                "Always you sing beautifully in concerts",
                "Every day it runs around the big garden",
                "Sometimes I see beautiful rainbows outside",
                "Usually she writes long emails to family",
                "Often we learn difficult English grammar"
            ]
        };

        // Odd words that don't make sense in the sentences
        const oddWords = [
            "pizza", "dinosaur", "spaceship", "robot", "unicorn", 
            "volcano", "telescope", "guitar", "mountain", "ocean",
            "castle", "dragon", "pirate", "rocket", "magic",
            "rainbow", "butterfly", "diamond", "planet", "comet"
        ];

        // Star and medal system
        const getStarsAndMedal = (score) => {
            const stars = Math.floor(score / 500);
            let medal = null;
            
            if (stars >= 12) {
                medal = { type: "platinum", label: "P" };
            } else if (stars >= 9) {
                medal = { type: "gold", label: "G" };
            } else if (stars >= 6) {
                medal = { type: "silver", label: "S" };
            } else if (stars >= 3) {
                medal = { type: "bronze", label: "B" };
            }
            
            return { stars, medal };
        };

        // Game variables
        let currentSentence = "";
        let currentLevel = "A1";
        let score = 0;
        let currentWordIndex = 0;
        let username = "";
        let gameStarted = false;
        let currentPhase = 1;
        let sentencesCompleted = 0;
        let currentStreak = 0;
        let usedSentences = [];
        let ranking = JSON.parse(localStorage.getItem('wordsmithRanking')) || [];
        let streakSoundPlayed = false;
        let playedMilestones = new Set();

        // DOM elements
        const wordCloud = document.getElementById('word-cloud');
        const sentenceDisplay = document.getElementById('sentence-display');
        const checkBtn = document.getElementById('check-btn');
        const resetBtn = document.getElementById('reset-btn');
        const nextBtn = document.getElementById('next-btn');
        const giveupBtn = document.getElementById('giveup-btn');
        const feedback = document.getElementById('feedback');
        const scoreDisplay = document.getElementById('score');
        const levelDisplay = document.getElementById('level');
        const phaseDisplay = document.getElementById('phase');
        const sentencesCompletedDisplay = document.getElementById('sentences-completed');
        const streakDisplay = document.getElementById('streak');
        const usernameInput = document.getElementById('username');
        const startBtn = document.getElementById('start-btn');
        const rankingList = document.getElementById('ranking-list');
        const confettiCanvas = document.getElementById('confetti-canvas');

        // Initialize the game
        function initGame() {
            if (!username) {
                showFeedback("Please enter your name to start!", "error");
                return;
            }
            
            gameStarted = true;
            score = 0;
            currentLevel = "A1";
            currentPhase = 1;
            sentencesCompleted = 0;
            currentStreak = 0;
            usedSentences = [];
            streakSoundPlayed = false;
            playedMilestones.clear();
            updateScore();
            updateLevel();
            updatePhase();
            updateSentencesCompleted();
            updateStreak();
            enableButtons();
            loadSentence();
            updateRankingDisplay();
            
            showFeedback("Click the words in the correct order!", "info");
        }

        // Load a new sentence
        function loadSentence() {
            // Select a random sentence from current phase that hasn't been used
            const phaseSentences = sentencesByPhase[currentPhase];
            const availableSentences = phaseSentences.filter(sentence => !usedSentences.includes(sentence));
            
            if (availableSentences.length === 0) {
                // If all sentences have been used, reset the used sentences for this phase
                usedSentences = [];
                loadSentence();
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * availableSentences.length);
            currentSentence = availableSentences[randomIndex];
            usedSentences.push(currentSentence);
            
            // Create array of words from the sentence
            const words = currentSentence.split(' ');
            currentWordIndex = 0;
            
            // Clear areas
            wordCloud.innerHTML = '';
            sentenceDisplay.innerHTML = '';
            
            // Add one odd word
            const oddWord = oddWords[Math.floor(Math.random() * oddWords.length)];
            words.push(oddWord);
            
            // Shuffle the words
            const shuffledWords = shuffleArray([...words]);
            
            // Add words to the cloud
            shuffledWords.forEach(word => {
                const wordElement = document.createElement('div');
                wordElement.className = 'word';
                wordElement.textContent = word;
                
                // Add click event
                wordElement.addEventListener('click', () => handleWordClick(wordElement, word, oddWord));
                
                wordCloud.appendChild(wordElement);
            });
            
            // Update feedback
            showFeedback(`Phase ${currentPhase}: Click the words in order`, "info");
            
            // Disable next button until sentence is completed
            nextBtn.disabled = true;
        }

        // Shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Handle word click
        function handleWordClick(wordElement, word, oddWord) {
            if (!gameStarted) return;
            
            // Check if the word is an odd word
            if (word === oddWord) {
                score = Math.max(0, score - 15);
                currentStreak = 0;
                streakSoundPlayed = false;
                updateScore();
                updateStreak();
                
                wordElement.classList.add('wrong');
                setTimeout(() => {
                    wordElement.classList.remove('wrong');
                }, 1000);
                
                showFeedback("That word doesn't belong! -15 points", "error");
                return;
            }
            
            // Check if the word is the next correct one
            const correctWord = currentSentence.split(' ')[currentWordIndex];
            
            if (word === correctWord) {
                // Correct word
                const newWord = document.createElement('div');
                newWord.className = 'word in-sentence correct';
                newWord.textContent = word;
                sentenceDisplay.appendChild(newWord);
                
                wordElement.style.visibility = 'hidden';
                currentWordIndex++;
                score += 10;
                currentStreak++;
                updateScore();
                updateStreak();
                
                showFeedback("Correct! Keep going!", "success");
                
                // Play streak sound after 5 consecutive correct answers (only once per streak)
                if (currentStreak === 5 && !streakSoundPlayed) {
                    playStreakSound();
                    streakSoundPlayed = true;
                    showFeedback(`Amazing! ${currentStreak} in a row!`, "success");
                }
                
                // Check special sound milestones
                checkSpecialSounds();
                
                // Check if sentence is complete
                if (currentWordIndex === currentSentence.split(' ').length) {
                    score += 50; // Bonus for completing the sentence
                    updateScore();
                    sentencesCompleted++;
                    updateSentencesCompleted();
                    streakSoundPlayed = false; // Reset for next sentence
                    
                    showFeedback("Excellent! Sentence completed! +50 points", "success");
                    
                    // Enable next button
                    nextBtn.disabled = false;
                    
                    // Check if we should advance phase
                    if (sentencesCompleted >= 3) {
                        setTimeout(() => {
                            advancePhase();
                        }, 2000);
                    }
                }
            } else {
                // Wrong word
                score = Math.max(0, score - 10);
                currentStreak = 0;
                streakSoundPlayed = false;
                updateScore();
                updateStreak();
                
                wordElement.classList.add('wrong');
                setTimeout(() => {
                    wordElement.classList.remove('wrong');
                }, 1000);
                
                showFeedback("Incorrect! Try the right word. -10 points", "error");
            }
        }

        // Check and play special sounds for milestones
        function checkSpecialSounds() {
            // First 1000 points - Star Wars sound
            if (score >= 1000 && !playedMilestones.has('first1000')) {
                playStarWarsSound();
                playedMilestones.add('first1000');
                showFeedback("üåü Amazing! You reached 1000 points! üåü", "success");
            }
            
            // Multiples of 1500 points - ICQ sound
            if (score >= 1500 && score % 1500 === 0 && !playedMilestones.has(`icq${score}`)) {
                playICQSound();
                playedMilestones.add(`icq${score}`);
                showFeedback(`üìØ ICQ! ${score} points milestone! üìØ`, "success");
            }
            
            // Multiples of 5000 points - Special achievement sound
            if (score >= 5000 && score % 5000 === 0 && !playedMilestones.has(`special${score}`)) {
                playSpecialAchievementSound();
                playedMilestones.add(`special${score}`);
                showFeedback(`üéâ INCREDIBLE! ${score} POINTS! üéâ`, "success");
                showConfetti();
            }
        }

        // Play ICQ sound (famous "uh-oh" sound)
        function playICQSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sine';
            gainNode.gain.value = 0.3;
            
            // ICQ "uh-oh" sound pattern
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(349.23, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime + 0.2);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.4);
        }

        // Play Star Wars Imperial March snippet
        function playStarWarsSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sawtooth';
            gainNode.gain.value = 0.2;
            
            // Star Wars Imperial March opening
            const notes = [392, 392, 392, 311.13, 466.16, 392, 311.13, 466.16, 392];
            const durations = [0.5, 0.5, 0.5, 0.35, 0.15, 0.5, 0.35, 0.15, 1];
            
            let time = audioContext.currentTime;
            notes.forEach((freq, index) => {
                oscillator.frequency.setValueAtTime(freq, time);
                time += durations[index];
            });
            
            oscillator.start();
            oscillator.stop(time);
        }

        // Play special achievement sound for 5000+ points
        function playSpecialAchievementSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'square';
            gainNode.gain.value = 0.2;
            
            // Victory fanfare
            const notes = [523.25, 659.25, 783.99, 1046.50, 1046.50, 1046.50, 1174.66];
            const durations = [0.2, 0.2, 0.2, 0.4, 0.4, 0.4, 0.8];
            
            let time = audioContext.currentTime;
            notes.forEach((freq, index) => {
                oscillator.frequency.setValueAtTime(freq, time);
                time += durations[index];
            });
            
            oscillator.start();
            oscillator.stop(time);
        }

        // Advance to next phase
        function advancePhase() {
            if (currentPhase < 11) {
                currentPhase++;
                sentencesCompleted = 0;
                usedSentences = [];
                updatePhase();
                updateSentencesCompleted();
                
                // Play success sound
                playSuccessSound();
                
                // Show confetti
                showConfetti();
                
                showFeedback(`Congratulations! You advanced to Phase ${currentPhase}!`, "success");
                
                // Load next sentence after a delay
                setTimeout(() => {
                    loadSentence();
                }, 3000);
            } else {
                // Game completed
                showFeedback("Amazing! You've completed all phases! You're a true Wordsmith!", "success");
                playSuccessSound();
                showConfetti();
                updateRanking();
            }
        }

        // Load next sentence
        function nextSentence() {
            if (!gameStarted) return;
            
            loadSentence();
            nextBtn.disabled = true;
        }

        // Reset current sentence
        function resetSentence() {
            if (!gameStarted) return;
            
            currentWordIndex = 0;
            currentStreak = 0;
            streakSoundPlayed = false;
            sentenceDisplay.innerHTML = '';
            updateStreak();
            
            // Reset all words in the cloud
            const words = wordCloud.querySelectorAll('.word');
            words.forEach(word => {
                word.style.visibility = 'visible';
                word.classList.remove('correct', 'wrong');
            });
            
            showFeedback("Sentence reset. Try again!", "info");
            nextBtn.disabled = true;
        }

        // Give up current game
        function giveUp() {
            if (!gameStarted) return;
            
            if (confirm("Are you sure you want to give up? Your score will be saved to the ranking.")) {
                updateRanking();
                showFeedback(`Game over! Your score: ${score} has been saved.`, "info");
                resetGame();
            }
        }

        // Reset the game
        function resetGame() {
            gameStarted = false;
            usernameInput.disabled = false;
            startBtn.disabled = false;
            checkBtn.disabled = true;
            resetBtn.disabled = true;
            nextBtn.disabled = true;
            giveupBtn.disabled = true;
            
            showFeedback("Enter your name and click 'Start Game' to play again!", "info");
        }

        // Update score display
        function updateScore() {
            scoreDisplay.textContent = score;
        }

        // Update level display
        function updateLevel() {
            levelDisplay.textContent = currentLevel;
        }

        // Update phase display
        function updatePhase() {
            phaseDisplay.textContent = `${currentPhase}/11`;
        }

        // Update sentences completed display
        function updateSentencesCompleted() {
            sentencesCompletedDisplay.textContent = `${sentencesCompleted}/3`;
        }

        // Update streak display
        function updateStreak() {
            streakDisplay.textContent = currentStreak;
        }

        // Enable game buttons
        function enableButtons() {
            checkBtn.disabled = false;
            resetBtn.disabled = false;
            nextBtn.disabled = true; // Next starts disabled
            giveupBtn.disabled = false;
            usernameInput.disabled = true;
            startBtn.disabled = true;
        }

        // Show feedback with different styles
        function showFeedback(message, type) {
            feedback.textContent = message;
            
            switch(type) {
                case "success":
                    feedback.style.borderColor = "#58CC02";
                    feedback.style.color = "#58CC02";
                    break;
                case "error":
                    feedback.style.borderColor = "#FF4B4B";
                    feedback.style.color = "#FF4B4B";
                    break;
                case "info":
                default:
                    feedback.style.borderColor = "#1CB0F6";
                    feedback.style.color = "#1CB0F6";
                    break;
            }
        }

        // Update ranking
        function updateRanking() {
            // Add current player to ranking
            const playerIndex = ranking.findIndex(player => player.name === username);
            const { stars, medal } = getStarsAndMedal(score);
            
            if (playerIndex !== -1) {
                // Update existing player if score is higher
                if (score > ranking[playerIndex].score) {
                    ranking[playerIndex].score = score;
                    ranking[playerIndex].phase = currentPhase;
                    ranking[playerIndex].stars = stars;
                    ranking[playerIndex].medal = medal;
                }
            } else {
                // Add new player
                ranking.push({
                    name: username,
                    score: score,
                    phase: currentPhase,
                    stars: stars,
                    medal: medal
                });
            }
            
            // Sort ranking by score (descending)
            ranking.sort((a, b) => b.score - a.score);
            
            // Keep only top 10 players
            if (ranking.length > 10) {
                ranking = ranking.slice(0, 10);
            }
            
            // Save to localStorage
            localStorage.setItem('wordsmithRanking', JSON.stringify(ranking));
            
            // Update display
            updateRankingDisplay();
        }

        // Update ranking display with stars and medals
        function updateRankingDisplay() {
            rankingList.innerHTML = '';
            
            if (ranking.length === 0) {
                const emptyItem = document.createElement('li');
                emptyItem.className = 'ranking-item';
                emptyItem.textContent = 'No players yet. Be the first!';
                rankingList.appendChild(emptyItem);
                return;
            }
            
            ranking.forEach((player, index) => {
                const rankingItem = document.createElement('li');
                rankingItem.className = 'ranking-item';
                
                const positionSpan = document.createElement('span');
                positionSpan.className = 'ranking-position';
                positionSpan.textContent = `${index + 1}.`;
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'ranking-name';
                nameSpan.textContent = player.name;
                
                const scoreSpan = document.createElement('span');
                scoreSpan.className = 'ranking-score';
                scoreSpan.textContent = `${player.score}`;
                
                const phaseSpan = document.createElement('span');
                phaseSpan.className = 'ranking-phase';
                phaseSpan.textContent = `Phase ${player.phase}`;
                
                rankingItem.appendChild(positionSpan);
                rankingItem.appendChild(nameSpan);
                rankingItem.appendChild(scoreSpan);
                rankingItem.appendChild(phaseSpan);
                
                // Add stars
                const starsContainer = document.createElement('div');
                starsContainer.className = 'stars-container';
                
                const starsCount = player.stars || Math.floor(player.score / 500);
                for (let i = 0; i < starsCount; i++) {
                    const star = document.createElement('span');
                    star.className = 'star';
                    star.textContent = '‚≠ê';
                    starsContainer.appendChild(star);
                }
                
                rankingItem.appendChild(starsContainer);
                
                // Add medal
                const playerMedal = player.medal || getStarsAndMedal(player.score).medal;
                if (playerMedal) {
                    const medalElement = document.createElement('div');
                    medalElement.className = `medal ${playerMedal.type}`;
                    medalElement.textContent = playerMedal.label;
                    medalElement.title = `${playerMedal.type.charAt(0).toUpperCase() + playerMedal.type.slice(1)} Medal`;
                    rankingItem.appendChild(medalElement);
                }
                
                rankingList.appendChild(rankingItem);
            });
        }

        // Play success sound
        function playSuccessSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sine';
            oscillator.frequency.value = 523.25;
            gainNode.gain.value = 0.3;
            
            oscillator.start();
            
            // Create a simple melody
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
            oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3);
            
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Play streak sound
        function playStreakSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'square';
            oscillator.frequency.value = 880;
            gainNode.gain.value = 0.2;
            
            oscillator.start();
            
            // Create a rising sequence
            oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(987.77, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(1108.73, audioContext.currentTime + 0.2);
            oscillator.frequency.setValueAtTime(1318.51, audioContext.currentTime + 0.3);
            
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Show confetti animation
        function showConfetti() {
            const canvas = confettiCanvas;
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const confettiCount = 150;
            const confetti = [];
            
            // Create confetti particles
            for (let i = 0; i < confettiCount; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    size: Math.random() * 8 + 4,
                    color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                    speed: Math.random() * 3 + 2,
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 10 - 5
                });
            }
            
            // Animation function
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                let stillFalling = false;
                
                for (let i = 0; i < confetti.length; i++) {
                    const c = confetti[i];
                    
                    // Update position
                    c.y += c.speed;
                    c.rotation += c.rotationSpeed;
                    
                    // Draw confetti
                    ctx.save();
                    ctx.translate(c.x, c.y);
                    ctx.rotate(c.rotation * Math.PI / 180);
                    ctx.fillStyle = c.color;
                    ctx.fillRect(-c.size/2, -c.size/2, c.size, c.size);
                    ctx.restore();
                    
                    // Check if still falling
                    if (c.y < canvas.height) {
                        stillFalling = true;
                    }
                }
                
                // Continue animation if confetti is still falling
                if (stillFalling) {
                    requestAnimationFrame(animate);
                } else {
                    // Clear canvas when animation is done
                    setTimeout(() => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    }, 1000);
                }
            }
            
            // Start animation
            animate();
        }

        // Event listeners for buttons
        startBtn.addEventListener('click', () => {
            username = usernameInput.value.trim();
            if (username) {
                initGame();
            }
        });

        // Allow Enter key to start game
        usernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                username = usernameInput.value.trim();
                if (username) {
                    initGame();
                }
            }
        });

        checkBtn.addEventListener('click', () => {
            // For click version, we don't need a separate check button
            // The game automatically checks as you click words
        });

        resetBtn.addEventListener('click', resetSentence);
        nextBtn.addEventListener('click', nextSentence);
        giveupBtn.addEventListener('click', giveUp);

        // Update ranking when page loads
        window.addEventListener('DOMContentLoaded', updateRankingDisplay);
        
        // Update ranking when the game ends (when leaving the page)
        window.addEventListener('beforeunload', () => {
            if (gameStarted) {
                updateRanking();
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (confettiCanvas) {
                confettiCanvas.width = window.innerWidth;
                confettiCanvas.height = window.innerHeight;
            }
        });
    </script>
</body>
</html>
